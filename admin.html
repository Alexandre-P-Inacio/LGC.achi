<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Architecture Portfolio</title>
    <link rel="icon" type="image/png" href="assets/LGC LOGO.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- jQuery required for Turn.js -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Turn.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    <!-- PDF.js for PDF processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Initialize the Supabase client correctly
        const supabaseUrl = 'https://pwsgmskiamkpzgtlaikm.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3c2dtc2tpYW1rcHpndGxhaWttIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQzNzM5NzIsImV4cCI6MjA1OTk0OTk3Mn0.oYGnYIpOUteNha2V1EoyhgxDA1XFfzxTjY8jAbSyLmI';
        window.supabase = supabase.createClient(supabaseUrl, supabaseKey);
        console.log('Supabase client initialized in admin.html');
    </script>
    <script src="auth.js" defer></script>
    <script src="admin.js" defer></script>
    <style>
        :root {
            --primary-color: #333;
            --primary-dark: #222;
            --secondary-color: #28a745;
            --accent-color: #000000c9;
            --dark-color: #333;
            --light-color: #f8f9fa;
            --danger-color: #dc3545;
            --warning-color: #fd7e14;
            --success-color: #28a745;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            --transition: all 0.3s ease;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            font-weight: 700;
            letter-spacing: 1px;
            color: #222;
        }
        
        .nav-links a {
            position: relative;
            transition: var(--transition);
            color: #333;
            text-decoration: none;
        }
        
        .nav-links a:hover {
            color: #000000c9;
        }
        
        .nav-links a:after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -2px;
            left: 0;
            background-color: #000000c9;
            transition: width 0.3s ease;
        }
        
        .nav-links a:hover:after {
            width: 100%;
        }
        
        #admin-name {
            color: #000;
            font-weight: 500;
            padding: 0.5rem 1rem;
            background-color: rgba(0, 0, 0, 0);
            border-radius: 6px;
            display: inline-block;
        }
        
        .admin-main {
            padding: 2rem;
            max-width: 1400px;
            margin: 1rem auto 2rem;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card:nth-child(1) {
            border-left-color: var(--primary-color);
        }
        
        .stat-card:nth-child(2) {
            border-left-color: var(--success-color);
        }
        
        .stat-card:nth-child(3) {
            border-left-color: var(--warning-color);
        }
        
        .stat-card:nth-child(4) {
            border-left-color: var(--danger-color);
        }
        
        .stat-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-right: 1rem;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(52, 152, 219, 0.2));
        }
        
        .stat-card:nth-child(1) .stat-icon {
            color: var(--primary-color);
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(52, 152, 219, 0.2));
        }
        
        .stat-card:nth-child(2) .stat-icon {
            color: var(--success-color);
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(46, 204, 113, 0.2));
        }
        
        .stat-card:nth-child(3) .stat-icon {
            color: var(--warning-color);
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(241, 196, 15, 0.2));
        }
        
        .stat-card:nth-child(4) .stat-icon {
            color: var(--danger-color);
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(231, 76, 60, 0.2));
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--dark-color);
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .admin-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 0.75rem;
            color: var(--primary-color);
        }
        
        .projects-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .projects-table th {
            background-color: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--dark-color);
            border-bottom: 2px solid #eee;
        }
        
        .projects-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }
        
        .projects-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .project-title {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.25rem;
        }
        
        .project-description {
            color: #7f8c8d;
            font-size: 0.9rem;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .pagination-button {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .pagination-button:hover {
            background-color: #444444;
            color: white;
            border-color: #444444;
        }
        
        .pagination-button:disabled {
            background-color: #f5f5f5;
            color: #aaa;
            cursor: not-allowed;
            border-color: #ddd;
        }
        
        .pagination-button:disabled:hover {
            background-color: #f5f5f5;
            color: #aaa;
            border-color: #ddd;
            transform: none;
        }
        
        .page-numbers {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .page-number {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.5rem 0.75rem;
            min-width: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            color: #333;
        }
        
        .page-number.active, .page-number:hover {
            background-color: #444444;
            color: white;
            border-color: #444444;
        }
        
        .page-ellipsis {
            padding: 0.5rem 0.25rem;
            color: #333;
            font-weight: bold;
        }
        
        footer {
            margin-top: 2rem;
            padding: 2rem;
            background-color: var(--dark-color);
            color: white;
            text-align: center;
        }
        
        /* Additional styles for status badges */
        .status-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        /* Verde para TRUE (Completed) */
        .status-completed {
            background-color: var(--success-color);
            color: white;
        }
        
        /* Amarelo para NULL (In Progress) */
        .status-in-progress {
            background-color: var(--warning-color);
            color: white;
        }
        
        /* Vermelho para FALSE (Incompleted) */
        .status-incompleted {
            background-color: var(--danger-color);
            color: white;
        }
        
        /* Melhorado design dos botões */
        .action-button {
            padding: 0.6rem 1rem;
            background-color: white;
            color: var(--primary-color);
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            font-weight: 500;
            text-decoration: none;
        }
        
        .action-button:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .action-button:hover i {
            color: white;
        }
        
        .action-button i {
            color: var(--primary-color);
            margin-right: 0.5rem;
            font-size: 1rem;
        }
        
        .delete-button i {
            color: var(--danger-color);
        }
        
        .delete-button:hover {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .delete-button:hover i {
            color: white;
        }
        
        /* Improved filter select styling */
        .filter-select {
            padding: 0.8rem 1rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
            color: #333;
            font-family: inherit;
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 150px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #444;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }
        
        /* Updated Search Bar Styling */
        .search-filter-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .search-container {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 250px;
            max-width: 500px;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            padding-right: 10px;
        }
        
        .search-container:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(51, 51, 51, 0.15);
        }
        
        #search-projects, #search-users {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border: none;
            background-color: transparent;
            font-size: 0.95rem;
            transition: all 0.3s;
            outline: none;
            color: #333;
        }
        
        #search-projects::placeholder, #search-users::placeholder {
            color: #888;
            opacity: 0.8;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            font-size: 14px;
        }
        
        /* Error message styling */
        .no-data {
            padding: 2rem;
            text-align: center;
            color: #7f8c8d;
        }
        
        /* File link styling */
        .file-link {
            color: var(--primary-color);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: var(--transition);
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-link i {
            margin-right: 0.5rem;
            flex-shrink: 0;
        }
        
        .file-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        
        /* Add project button styling to match site */
        .add-project-button {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #333;
            border: 1px solid #333;
            display: inline-flex;
            align-items: center;
            background: transparent;
            cursor: pointer;
            box-shadow: none;
            min-width: 140px;
            justify-content: center;
        }
        
        .add-project-button i {
            margin-right: 0.5rem;
        }
        
        .add-project-button:hover {
            background: #444444;  
            color: rgb(255, 255, 255);
        }
        
        .add-project-button:active {
            background: #333333;
        }
        
        /* Styling for reset filters button - also updating this to match */
        .reset-filters-button {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #333;
            border: 1px solid #333;
            display: inline-flex;
            align-items: center;
            background: transparent;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .reset-filters-button i {
            margin-right: 0.5rem;
        }
        
        .reset-filters-button:hover {
            background: #444444;  
            color: rgb(255, 255, 255);
        }
        
        .reset-filters-button:active {
            background: #333333;
        }
        
        /* Flipbook additional styles */
        #flipbook-container {
            margin: 0 auto;
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        /* Adjust modal for flipbook */
        .modal-content {
            width: 70%;
            max-width: 900px;
            max-height: 100vh;
            height: 100vh;
        }
        
        /* Add page turning effect */
        ._df_book {
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        /* Make file viewer fill available space */
        #file-viewer-container {
            min-height: 600px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        #flipbook-wrapper {
            height: 100%;
            display: flex;
            flex-direction: column;
            flex: 1;
            width: 100%;
        }
        
        #flipbook {
            width: 100%;
            height: 100%;
            flex: 1;
            margin: 0 auto;
            display: none;
        }
        
        #flipbook .page {
            background-color: white;
            background-size: 100% 100%;
            border-radius: 0;
        }
        
        #flipbook .hard {
            background-color: #f5f5f5;
            color: #333;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: solid 1px #c2c2c2;
        }
        
        .flipbook-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 600px;
        }
        
        .modal-loading p {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #333;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Flipbook navigation container */
        .flipbook-nav {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        /* Flipbook navigation buttons */
        .flipbook-nav button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(68, 68, 68, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            pointer-events: auto;
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        #prev-page-btn {
            left: 20px;
        }
        
        #next-page-btn {
            right: 20px;
        }
        
        /* Enhance modal for better mobile experience */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-height: 100vh;
                height: 100vh;
            }
            
            #flipbook-container {
                height: 100%;
            }
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-spinner-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color, #3a7bd5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        .loading-message {
            font-size: 14px;
            color: #333;
        }
        
        /* Notification System */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9998;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .notification {
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 6px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 350px;
            opacity: 0;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification i {
            font-size: 20px;
        }
        
        .notification-info i {
            color: #3a7bd5;
        }
        
        .notification-success i {
            color: #28a745;
        }
        
        .notification-error i {
            color: #dc3545;
        }
        
        .notification-warning i {
            color: #ffc107;
        }
        
        /* Modern User Modal Styles */
        #user-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        #user-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        #user-modal .modal-content {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 95%;
            margin: 0 auto;
            transform: translateY(20px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: none;
        }
        
        #user-modal.show .modal-content {
            transform: translateY(0);
        }
        
        @keyframes modal-slide-in {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        #user-modal .modal-header {
            background-color: #333;
            border-bottom: 1px solid #444;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        #user-modal .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            letter-spacing: 0.5px;
        }
        
        #user-modal .modal-header h3::before {
            content: "\f007";
            font-family: "Font Awesome 5 Free";
            margin-right: 12px;
            color: white;
            font-weight: 900;
            font-size: 1.2rem;
        }
        
        #user-modal .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.2s;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        #user-modal .close-modal:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        #user-modal .modal-body {
            padding: 25px;
        }
        
        #user-modal .form-group {
            margin-bottom: 20px;
        }
        
        #user-modal .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
            font-size: 0.95rem;
        }
        
        #user-modal .form-group input,
        #user-modal .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }
        
        #user-modal .form-group input:focus,
        #user-modal .form-group select:focus {
            outline: none;
            border-color: #333;
            box-shadow: 0 0 0 3px rgba(51, 51, 51, 0.1);
            background-color: #fff;
        }
        
        #user-modal .form-group small {
            display: block;
            margin-top: 6px;
            color: #888;
            font-size: 0.8rem;
        }
        
        .password-requirements {
            margin-top: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 10px;
            border-left: 3px solid #333;
        }
        
        .password-requirements small {
            font-weight: 500;
            color: #333;
        }
        
        .password-requirements ul {
            margin: 5px 0 0 0;
            padding-left: 20px;
            font-size: 0.75rem;
            color: #555;
        }
        
        .password-requirements li {
            margin-bottom: 3px;
        }
        
        #user-modal .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        #user-modal .cancel-button,
        #user-modal .submit-button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        
        #user-modal .cancel-button {
            background-color: #f1f1f1;
            color: #444;
            border: 1px solid #ddd;
        }
        
        #user-modal .submit-button {
            background-color: #333;
            color: white;
            border: 1px solid #333;
        }
        
        #user-modal .cancel-button:hover {
            background-color: #e5e5e5;
        }
        
        #user-modal .submit-button:hover {
            background-color: #222;
        }
        
        #user-modal .cancel-button:active,
        #user-modal .submit-button:active {
            transform: scale(0.97);
        }
        
        .flipbook-nav button:hover {
            background-color: #444444;
            opacity: 1;
            transform: translateY(-50%) scale(1.05);
        }
        
        .flipbook-nav button:disabled {
            background-color: rgba(170, 170, 170, 0.5);
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .flipbook-nav button:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* User Management Table Styles */
        .projects-table th, .projects-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        /* Specific alignment for user management table */
        #users-container td {
            text-align: left;
            padding: 1rem;
            vertical-align: middle;
        }

        #users-container td:nth-child(1) {
            width: 40%;
        }

        #users-container td:nth-child(2) {
            width: 30%;
            text-align: center;
        }

        #users-container td:nth-child(3) {
            width: 30%;
            text-align: right;
        }

        /* Role badge centering */
        #users-container .status-badge {
            display: inline-flex;
            justify-content: center;
            min-width: 100px;
        }

        /* Action buttons alignment */
        #users-container .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Table header alignment to match content */
        .projects-table thead th:nth-child(2) {
            text-align: center;
        }

        .projects-table thead th:nth-child(3) {
            text-align: right;
        }

        .projects-table td:nth-child(3), .projects-table th:nth-child(3) {
            text-align: center;
        }

        .projects-table th { text-align: center; }
        .projects-table th:first-child, .projects-table td:first-child { text-align: left; }
        .projects-table td:nth-child(2), .projects-table th:nth-child(2),
        .projects-table td:nth-child(3), .projects-table th:nth-child(3),
        .projects-table td:nth-child(4), .projects-table th:nth-child(4),
        .projects-table td:nth-child(5), .projects-table th:nth-child(5),
        .projects-table td:nth-child(6), .projects-table th:nth-child(6),
        .projects-table td:nth-child(7), .projects-table th:nth-child(7) {
            text-align: center;
        }

        /* Projects table container with improved scrolling */
        .projects-table-container {
            max-width: 100%;
            -webkit-overflow-scrolling: touch; /* For smooth scrolling on iOS */
            margin-bottom: 20px;
        }

        /* Additional responsive adjustments for tablet mode */
        @media (max-width: 1024px) {
            .table-responsive {
                border: 0;
                margin-bottom: 15px;
            }
            
            .projects-table-container {
                overflow-x: auto;
                padding-bottom: 10px; /* Add space for scrollbar */
                margin-left: -15px;
                margin-right: -15px;
                padding-left: 15px;
                padding-right: 15px;
                width: calc(100% + 30px);
            }
            
            .projects-table {
                min-width: 900px; /* Ensure table has minimum width to enable scrolling */
                margin-bottom: 0;
            }
            
            /* Prevent text wrapping in table cells for better horizontal scrolling */
            .projects-table th, 
            .projects-table td {
                white-space: nowrap;
            }
            
            /* Fix for action buttons on mobile */
            .action-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            
            /* Ensure drop shadows don't get cut off */
            .admin-section {
                overflow: visible;
            }
        }

        /* Fix for mobile view */
        @media (max-width: 576px) {
            .projects-table-container {
                margin-left: -15px;
                margin-right: -15px;
                width: calc(100% + 30px);
            }

            .projects-table {
                min-width: 800px;
            }
        }

        .projects-table td:last-child, .projects-table th:last-child {
            padding-right: 32px !important;
        }

        /* Add these styles to the existing CSS in the head section */
        .modal-content {
            width: 90%;
            max-width: 1200px;
            max-height: 100%;
            border-radius: 12px;
            overflow: hidden;
        }

        .file-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #666;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #007bff;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #video-wrapper {
            width: 100%;
            margin: 0 auto;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #video-player {
            max-height: 70vh;
            border-radius: 4px;
            width: 100%;
        }

        .video-controls {
            position: absolute;
            bottom: 60px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .video-control-button {
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
        }

        .video-control-button:hover {
            background-color: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }

        .action-button {
            padding: 8px 16px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background-color 0.3s;
        }

        .action-button:hover {
            background-color: #555;
            color: white;
        }

        /* Hide zoom buttons when showing video */
        #video-wrapper:not([style*="display: none"]) ~ .modal-footer #zoom-in-button,
        #video-wrapper:not([style*="display: none"]) ~ .modal-footer #zoom-out-button {
            display: none !important;
        }

        .modal-footer {
            padding: 1rem;
            display: flex;
            justify-content: flex-end;
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }

        .modal-controls {
            display: flex;
            gap: 10px;
        }

        .file-type-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: #007bff;
            color: white;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
            margin-right: 10px;
        }

        /* Table responsive class */
        .table-responsive {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Projects table container with improved scrolling */
        .projects-table-container {
            max-width: 100%;
            -webkit-overflow-scrolling: touch; /* For smooth scrolling on iOS */
            margin-bottom: 20px;
        }

        /* Additional responsive adjustments for tablet mode */
        @media (max-width: 1024px) {
            .table-responsive {
                border: 0;
                margin-bottom: 15px;
            }
            
            .projects-table-container {
                overflow-x: auto;
                padding-bottom: 10px; /* Add space for scrollbar */
                margin-left: -15px;
                margin-right: -15px;
                padding-left: 15px;
                padding-right: 15px;
                width: calc(100% + 30px);
            }
            
            .projects-table {
                min-width: 900px; /* Ensure table has minimum width to enable scrolling */
                margin-bottom: 0;
            }
            
            /* Prevent text wrapping in table cells for better horizontal scrolling */
            .projects-table th, 
            .projects-table td {
                white-space: nowrap;
            }
            
            /* Fix for action buttons on mobile */
            .action-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            
            /* Ensure drop shadows don't get cut off */
            .admin-section {
                overflow: visible;
            }
        }

        /* Fix for mobile view */
        @media (max-width: 576px) {
            .projects-table-container {
                margin-left: -15px;
                margin-right: -15px;
                width: calc(100% + 30px);
            }

            .projects-table {
                min-width: 800px;
            }
        }

        .projects-table td:last-child, .projects-table th:last-child {
            padding-right: 32px !important;
        }

        /* Featured star styling */
        .star-button .fa-star {
            color: #ccc;
            transition: color 0.3s;
        }

        .star-button.featured .fa-star {
            color: #FFD700; /* Gold/yellow color for featured projects */
        }
    </style>
</head>
<body onload="checkAdminAccess(); updateStats(); loadProjects(); loadUsers();">
    <button id="admin-hamburger" class="admin-hamburger" aria-label="Open menu">&#9776;</button>
    <div id="admin-mobile-menu" class="admin-mobile-menu">
      <div class="admin-mobile-menu-content">
        <span class="admin-mobile-welcome">Welcome, admin</span>
        <a href="index.html"><i class="fas fa-arrow-left"></i> Back to Site</a>
        <a href="#" id="admin-mobile-logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
      </div>
    </div>
    <div id="admin-mobile-overlay" class="admin-mobile-overlay"></div>
    <header>
        <nav>
            <div class="logo">
                <i class="fas fa-drafting-compass"></i>
                ADMIN DASHBOARD
            </div>
            <ul class="nav-links">
                <li><a href="index.html"><i class="fas fa-arrow-left"></i> Back to Site</a></li>
                <li><span id="admin-name"></span></li>
                <li><a href="#" id="logout-button"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </nav>
    </header>

    <main class="admin-main">
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="total-projects">0</div>
                    <div class="stat-label">Total Projects</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="completed-projects">0</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-spinner"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="in-progress-projects">0</div>
                    <div class="stat-label">In Progress</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="uncompleted-projects">0</div>
                    <div class="stat-label">Incompleted</div>
                </div>
            </div>
        </div>
        
        <section class="admin-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-folder-open"></i> Project Management</h2>
                <a href="project-form.html" class="add-project-button">
                    <i class="fas fa-plus"></i> Add New Project
                </a>
            </div>

            <div class="search-filter-container">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-projects" placeholder="Search projects..." oninput="autoSearch(this, 'projects')">
                </div>
                <div class="filter-container">
                    <select id="status-filter" class="filter-select" onchange="filterProjects()">
                        <option value="all">All status</option>
                        <option value="completed">Completed</option>
                        <option value="in_progress">In Progress</option>
                        <option value="incompleted">Incompleted</option>
                    </select>
                </div>
            </div>

            <div class="table-responsive projects-table-container">
                <table class="projects-table">
                    <thead>
                        <tr>
                            <th style="text-align: left;">Project Name</th>
                            <th style="text-align: center;">Category</th>
                            <th style="text-align: center;">Status</th>
                            <th style="text-align: center;">Type</th>
                            <th style="text-align: center;">File</th>
                            <th style="text-align: center;">Created</th>
                            <th style="text-align: center;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="projects-container">
                        <!-- Projects will be inserted here dynamically -->
                    </tbody>
                </table>
            </div>
            
            <div class="pagination-container">
                <div id="page-numbers" class="page-numbers">
                    <!-- Page numbers will be inserted here dynamically -->
                </div>
            </div>
        </section>
        
        <!-- User Management Section -->
        <section class="admin-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-users"></i> User Management</h2>
                <a href="javascript:void(0)" class="add-project-button" onclick="showUserModal()">
                    <i class="fas fa-plus"></i> Add New User
                </a>
            </div>

            <div class="search-filter-container">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-users" placeholder="Search users..." oninput="autoSearch(this, 'users')">
                </div>
                <div class="filter-container">
                    <select id="role-filter" class="filter-select" onchange="filterUsers()">
                        <option value="all">All roles</option>
                        <option value="admin">Admin</option>
                        <option value="user">User</option>
                    </select>
                </div>
            </div>

            <div class="table-responsive projects-table-container">
                <table class="projects-table">
                    <thead>
                        <tr>
                            <th style="text-align: left; width: 40%;">USERNAME</th>
                            <th style="text-align: center; width: 30%;">ROLE</th>
                            <th style="text-align: right; width: 30%;">ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody id="users-container">
                        <!-- Users will be inserted here dynamically -->
                    </tbody>
                </table>
            </div>
            
            <div class="pagination-container">
                <div id="users-page-numbers" class="page-numbers">
                    <!-- Page numbers will be inserted here dynamically -->
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Architecture Portfolio Admin. All rights reserved.</p>
        </div>
    </footer>

    <!-- File Viewer Modal -->
    <div id="file-viewer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-file-title">File Preview</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="file-info-bar">
                <div class="file-type-icon" id="file-type-icon">DOC</div>
                <span id="file-info">Loading file information...</span>
            </div>
            <div class="modal-body">
                <div id="file-viewer-container">
                    <!-- Turn.js Flipbook container -->
                    <div id="flipbook-wrapper">
                        <div id="flipbook"></div>
                        <div class="flipbook-nav">
                            <button id="prev-page-btn"><i class="fas fa-chevron-left"></i></button>
                            <button id="next-page-btn"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                    
                    <!-- Video preview element -->
                    <div id="video-wrapper" style="display: none;">
                        <video id="video-player" controls width="100%">
                            Your browser does not support the video tag.
                        </video>
                        <div class="video-controls">
                            <a id="video-download-button" href="#" class="video-control-button" download title="Download Video">
                                <i class="fas fa-download"></i>
                            </a>
                            <button id="video-fullscreen-button" class="video-control-button" title="Fullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Original preview elements -->
                    <iframe id="file-iframe" width="100%" height="600" style="display: none;"></iframe>
                    <img id="file-image" style="display: none;" />
                    <div id="file-unsupported" style="display: none;">
                        <i class="fas fa-file-alt"></i>
                        <h3>This file type cannot be previewed</h3>
                        <p>The file may need to be downloaded to be viewed.</p>
                        <a id="file-download-link" href="#" class="action-button">
                            <i class="fas fa-download"></i> Download File
                        </a>
                    </div>
                    <!-- Loading indicator -->
                    <div id="file-loading" class="file-loading">
                        <div class="spinner"></div>
                        <span>Loading preview...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="modal-controls">
                    <a id="download-button" href="#" class="action-button" download>
                        <i class="fas fa-download"></i> Download
                    </a>
                    <button id="zoom-in-button" class="action-button">
                        <i class="fas fa-search-plus"></i> Zoom In
                    </button>
                    <button id="zoom-out-button" class="action-button">
                        <i class="fas fa-search-minus"></i> Zoom Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="shareModalLabel">Compartilhar Projeto</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="shareUsername">Username:</label>
                        <input type="text" class="form-control" id="shareUsername" placeholder="Digite o username">
                    </div>
                    <div class="form-group">
                        <label for="sharePermission">Permissão:</label>
                        <select class="form-control" id="sharePermission">
                            <option value="read">Leitura</option>
                            <option value="edit">Edição</option>
                        </select>
                    </div>
                    <div id="shareError" class="alert alert-danger d-none"></div>
                    <div id="shareSuccess" class="alert alert-success d-none"></div>
                    
                    <!-- Current Shares Section -->
                    <div class="current-shares-section">
                        <h3>Compartilhado com:</h3>
                        <div class="current-shares-list">
                            <div class="loading-shares">Carregando...</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="shareButton">Compartilhar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Form Modal -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="user-modal-title">Add New User</h3>
                <button class="close-modal" onclick="closeUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="user-form">
                    <input type="hidden" id="user-id">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" required placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="user-password">Password</label>
                        <input type="password" id="user-password" placeholder="Enter password">
                        <small>Leave blank to keep current password when editing</small>
                        <div class="password-requirements">
                            <small>Password must contain:</small>
                            <ul>
                                <li>At least 8 characters</li>
                                <li>At least 1 uppercase letter</li>
                                <li>At least 1 lowercase letter</li>
                                <li>At least 1 number</li>
                                <li>At least 1 special character (!@#$%^&*...)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="user-role">Role</label>
                        <select id="user-role">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="cancel-button" onclick="closeUserModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="button" class="submit-button" onclick="saveUser()">
                            <i class="fas fa-save"></i> Save User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Initialize admin dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Admin page loaded.');
            
            // Check if required libraries are loaded
            const libraryCheck = {
                'jQuery': typeof $ !== 'undefined',
                'Turn.js': typeof $ !== 'undefined' && typeof $.fn.turn !== 'undefined',
                'PDF.js': typeof pdfjsLib !== 'undefined'
            };
            
            console.log('Library check:', libraryCheck);
            
            // Display warning if libraries are missing
            const missingLibraries = Object.keys(libraryCheck).filter(lib => !libraryCheck[lib]);
            if (missingLibraries.length > 0) {
                console.error('Missing libraries:', missingLibraries.join(', '));
                const warning = document.createElement('div');
                warning.style.position = 'fixed';
                warning.style.top = '10px';
                warning.style.right = '10px';
                warning.style.backgroundColor = '#f8d7da';
                warning.style.color = '#721c24';
                warning.style.padding = '10px';
                warning.style.borderRadius = '5px';
                warning.style.zIndex = '9999';
                warning.innerHTML = `Warning: Some libraries failed to load (${missingLibraries.join(', ')}). Flipbook functionality may be limited.`;
                document.body.appendChild(warning);
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    warning.style.display = 'none';
                }, 10000);
            }
            
            try {
                await ensureProjectsTable();
                console.log('Projects table check completed');
                
                // Initialize the file viewer modal
                initFileViewer();
            } catch (e) {
                console.error('Error in initial setup:', e);
            }
        });
        
        // Auto search function - trigger search after 3 letters
        let searchTimeouts = {};
        function autoSearch(inputElement, type) {
            const searchText = inputElement.value.trim();
            
            // Clear any pending timeout
            if (searchTimeouts[type]) {
                clearTimeout(searchTimeouts[type]);
            }
            
            // If at least 3 characters, search after small delay
            if (searchText.length >= 3) {
                searchTimeouts[type] = setTimeout(() => {
                    if (type === 'projects') {
                        searchProjects();
                    } else if (type === 'users') {
                        searchUsers();
                    }
                }, 300); // 300ms delay to avoid too many searches while typing
            } else if (searchText.length === 0) {
                // If search is cleared, reset to show all
                if (type === 'projects') {
                    loadProjects(1, getCurrentFilters());
                } else if (type === 'users') {
                    loadUsers(1, getUserFilters());
                }
            }
        }
        
        // Initialize file viewer modal
        function initFileViewer() {
            // Get modal elements
            const modal = document.getElementById('file-viewer-modal');
            const closeBtn = modal.querySelector('.close-modal');
            const flipbook = document.getElementById('flipbook');
            const prevBtn = document.getElementById('prev-page-btn');
            const nextBtn = document.getElementById('next-page-btn');
            
            // Configure PDF.js worker
            if (typeof pdfjsLib !== 'undefined') {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';
                console.log('PDF.js worker configured successfully');
            } else {
                console.error('PDF.js library not loaded properly!');
            }
            
            // Make the flipbook responsive
            window.addEventListener('resize', function() {
                if (flipbook && $(flipbook).turn("is")) {
                    const parent = flipbook.parentElement;
                    if (parent) {
                        const width = parent.clientWidth * 0.9;
                        $(flipbook).turn("size", width, 600);
                    }
                }
            });
            
            // Close modal when clicking the close button
            closeBtn.addEventListener('click', () => {
                modal.style.display = 'none';
                
                // Destroy any existing flipbook
                if (flipbook && $(flipbook).turn("is")) {
                    $(flipbook).turn("destroy");
                    flipbook.innerHTML = '';
                }
            });
            
            // Close modal when clicking outside the modal content
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    
                    // Destroy any existing flipbook
                    if (flipbook && $(flipbook).turn("is")) {
                        $(flipbook).turn("destroy");
                        flipbook.innerHTML = '';
                    }
                }
            });
            
            // Navigation buttons for flipbook - using multiple binding methods for maximum compatibility
            if (typeof $ !== 'undefined') {
                // jQuery binding
                $(prevBtn).off('click').on('click', function(e) {
                    e.preventDefault();
                    try {
                        console.log('Previous button clicked');
                        // Get current page
                        const currentPage = $(flipbook).turn('page');
                        console.log('Current page before previous:', currentPage);
                        
                        // Go to exactly one page back
                        if (currentPage > 1) {
                            $(flipbook).turn('page', currentPage - 1);
                        }
                    } catch (err) {
                        console.error('Error on previous button:', err);
                    }
                    return false;
                });
                
                $(nextBtn).off('click').on('click', function(e) {
                    e.preventDefault();
                    try {
                        console.log('Next button clicked');
                        // Get current page
                        const currentPage = $(flipbook).turn('page');
                        console.log('Current page before next:', currentPage);
                        
                        // Go to exactly one page forward
                        const totalPages = numPages + 2; // +2 for covers
                        if (currentPage < totalPages) {
                            $(flipbook).turn('page', currentPage + 1);
                        }
                    } catch (err) {
                        console.error('Error on next button:', err);
                    }
                    return false;
                });
            }
            
            // Also add standard event listeners as backup
            prevBtn.addEventListener('click', function(e) {
                if (flipbook && $(flipbook).turn("is")) {
                    $(flipbook).turn("previous");
                }
                e.preventDefault();
            });
            
            nextBtn.addEventListener('click', function(e) {
                if (flipbook && $(flipbook).turn("is")) {
                    $(flipbook).turn("next");
                }
                e.preventDefault();
            });
            
            // Initialize zoom controls
            const zoomInButton = document.getElementById('zoom-in-button');
            const zoomOutButton = document.getElementById('zoom-out-button');
            const imgPreview = document.getElementById('file-image');
            
            let currentZoom = 1;
            
            zoomInButton.addEventListener('click', function() {
                if (currentZoom < 3) {
                    currentZoom += 0.2;
                    imgPreview.style.transform = `scale(${currentZoom})`;
                }
            });
            
            zoomOutButton.addEventListener('click', function() {
                if (currentZoom > 0.5) {
                    currentZoom -= 0.2;
                    imgPreview.style.transform = `scale(${currentZoom})`;
                }
            });
        }
        
        // Show file in modal with appropriate preview based on file type
        function showFileInModal(fileUrl, fileName) {
            const modal = document.getElementById('file-viewer-modal');
            const title = document.getElementById('modal-file-title');
            const iframe = document.getElementById('file-iframe');
            const imgPreview = document.getElementById('file-image');
            const unsupportedView = document.getElementById('file-unsupported');
            const downloadLink = document.getElementById('file-download-link');
            const downloadButton = document.getElementById('download-button');
            const fileLoading = document.getElementById('file-loading');
            const fileInfo = document.getElementById('file-info');
            const fileTypeIcon = document.getElementById('file-type-icon');
            const zoomInButton = document.getElementById('zoom-in-button');
            const zoomOutButton = document.getElementById('zoom-out-button');
            const flipbook = document.getElementById('flipbook');
            const flipbookWrapper = document.getElementById('flipbook-wrapper');
            const prevBtn = document.getElementById('prev-page-btn');
            const nextBtn = document.getElementById('next-page-btn');
            
            // Reset zoom
            imgPreview.style.transform = 'scale(1)';
            
            // Show loading indicator
            fileLoading.style.display = 'flex';
            
            // Hide all preview elements initially
            iframe.style.display = 'none';
            imgPreview.style.display = 'none';
            unsupportedView.style.display = 'none';
            flipbookWrapper.style.display = 'none';
            flipbook.style.display = 'none';
            
            // Reset flipbook container
            flipbook.innerHTML = '';
            
            // Set the modal title to the file name
            title.textContent = fileName || 'File Preview';
            
            // Set download links
            downloadLink.href = fileUrl;
            downloadLink.setAttribute('download', fileName || 'download');
            downloadButton.href = fileUrl;
            downloadButton.setAttribute('download', fileName || 'download');
            
            // Determine file type and update file info
            const fileExtension = fileName.split('.').pop().toLowerCase();
            const fileTypeMap = {
                'jpg': { type: 'Image', icon: 'JPG', color: '#3a7bd5' },
                'jpeg': { type: 'Image', icon: 'JPG', color: '#3a7bd5' },
                'png': { type: 'Image', icon: 'PNG', color: '#28a745' },
                'gif': { type: 'Image', icon: 'GIF', color: '#fd7e14' },
                'svg': { type: 'Image', icon: 'SVG', color: '#6610f2' },
                'webp': { type: 'Image', icon: 'WP', color: '#20c997' },
                'pdf': { type: 'Document', icon: 'PDF', color: '#dc3545' },
                'txt': { type: 'Text', icon: 'TXT', color: '#6c757d' },
                'html': { type: 'Code', icon: 'HTML', color: '#e83e8c' },
                'htm': { type: 'Code', icon: 'HTML', color: '#e83e8c' },
                'css': { type: 'Code', icon: 'CSS', color: '#007bff' },
                'js': { type: 'Code', icon: 'JS', color: '#ffc107' },
                'doc': { type: 'Document', icon: 'DOC', color: '#007bff' },
                'docx': { type: 'Document', icon: 'DOCX', color: '#007bff' }
            };
            
            const fileType = fileTypeMap[fileExtension] || { type: 'Unknown', icon: 'FILE', color: '#6c757d' };
            fileInfo.textContent = `${fileType.type} • ${formatFileSize(1024 * 1024)} • ${formatDate(new Date())}`;
            fileTypeIcon.textContent = fileType.icon;
            fileTypeIcon.style.background = fileType.color;
            
            // Show or hide zoom buttons based on file type
            const canZoom = ['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp'].includes(fileExtension);
            zoomInButton.style.display = canZoom ? 'flex' : 'none';
            zoomOutButton.style.display = canZoom ? 'flex' : 'none';
            
            // Choose appropriate preview based on file extension
            if (['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp'].includes(fileExtension)) {
                // Image preview
                imgPreview.onload = function() {
                    fileLoading.style.display = 'none';
                    imgPreview.style.display = 'block';
                };
                imgPreview.onerror = function() {
                    fileLoading.style.display = 'none';
                    unsupportedView.style.display = 'block';
                };
                imgPreview.src = fileUrl;
            } 
            else if (['pdf'].includes(fileExtension)) {
                // PDF Flipbook using PDF.js and Turn.js
                flipbookWrapper.style.display = 'block';
                
                try {
                    console.log('Starting PDF processing for flipbook');
                    // First check if libraries are loaded
                    if (typeof pdfjsLib === 'undefined') {
                        throw new Error('PDF.js library not loaded');
                    }
                    
                    if (typeof $ === 'undefined' || typeof $.fn.turn === 'undefined') {
                        throw new Error('Turn.js library not loaded');
                    }
                    
                    // Load the PDF file
                    console.log('Loading PDF from URL:', fileUrl);
                    pdfjsLib.getDocument(fileUrl).promise.then(function(pdf) {
                        console.log('PDF loaded successfully with', pdf.numPages, 'pages');
                        
                        // Create pages for the flipbook
                        const numPages = pdf.numPages;
                        const pagesPromises = [];
                        
                        // Clear existing content first
                        flipbook.innerHTML = '';
                        
                        // Initialize the flipbook with only the exact required pages
                        for (let i = 1; i <= numPages; i++) {
                            const pageDiv = document.createElement('div');
                            pageDiv.className = 'page';
                            pageDiv.id = `page-${i}`;
                            pageDiv.style.position = 'relative';
                            pageDiv.style.overflow = 'hidden';
                            
                            // Loading placeholder
                            const placeholder = document.createElement('div');
                            placeholder.style.position = 'absolute';
                            placeholder.style.top = '50%';
                            placeholder.style.left = '50%';
                            placeholder.style.transform = 'translate(-50%, -50%)';
                            placeholder.style.color = '#999';
                            placeholder.textContent = `Loading page ${i}...`;
                            pageDiv.appendChild(placeholder);
                            
                            // Page number for reference
                            const pageNumber = document.createElement('div');
                            pageNumber.textContent = i;
                            pageNumber.style.position = 'absolute';
                            pageNumber.style.bottom = '10px';
                            pageNumber.style.right = '10px';
                            pageNumber.style.fontSize = '12px';
                            pageNumber.style.color = '#999';
                            pageNumber.style.zIndex = '100';
                            pageDiv.appendChild(pageNumber);
                            
                            flipbook.appendChild(pageDiv);
                        }
                        
                        // Initialize the flipbook 
                        $(flipbook).turn({
                            width: 800,
                            height: '100%',
                            autoCenter: true,
                            display: 'single', // Force single page mode
                            duration: 600,
                            acceleration: false, // Disable acceleration which can cause issues
                            gradients: true,
                            elevation: 50,
                            page: 1, // Start at page 1
                            when: {
                                turning: function(event, page, view) {
                                    console.log(`Turning to page ${page}, view:`, view);
                                    
                                    // Load current and adjacent pages
                                    loadPageContent(page);
                                    if (page > 1) loadPageContent(page - 1);
                                    if (page < numPages) loadPageContent(page + 1);
                                },
                                turned: function(event, page, view) {
                                    console.log(`Turned to page ${page}, view:`, view);
                                    
                                    // Update navigation button states
                                    prevBtn.disabled = page <= 1;
                                    nextBtn.disabled = page >= numPages;
                                    
                                    // Show current page in console
                                    console.log(`Current page is now ${page} of ${numPages}`);
                                }
                            }
                        });
                        
                        // Function to directly render PDF page to a canvas
                        async function loadPageContent(pageNum) {
                            if (pageNum < 1 || pageNum > numPages) return; // Skip invalid pages
                            
                            const pageDiv = document.getElementById(`page-${pageNum}`);
                            if (!pageDiv || pageDiv.querySelector('canvas')) return; // Skip if already loaded
                            
                            try {
                                // Get the page from PDF
                                const page = await pdf.getPage(pageNum);
                                
                                // Calculate scale to fit
                                const viewport = page.getViewport({scale: 1.0});
                                const containerWidth = 750; // Fixed container width
                                const containerHeight = 550; // Fixed container height
                                
                                // Calculate scale to fit
                                const scaleX = containerWidth / viewport.width;
                                const scaleY = containerHeight / viewport.height;
                                const scale = Math.min(scaleX, scaleY) * 0.95; // 95% to leave margin
                                
                                const scaledViewport = page.getViewport({scale});
                                
                                // Create canvas
                                const canvas = document.createElement('canvas');
                                canvas.width = scaledViewport.width;
                                canvas.height = scaledViewport.height;
                                
                                // Center canvas in page
                                canvas.style.position = 'absolute';
                                canvas.style.top = '50%';
                                canvas.style.left = '50%';
                                canvas.style.transform = 'translate(-50%, -50%)';
                                canvas.style.border = '1px solid #eee';
                                
                                // Remove loading placeholder and add canvas
                                pageDiv.innerHTML = '';
                                pageDiv.appendChild(canvas);
                                
                                // Add page number indicator
                                const pageNumber = document.createElement('div');
                                pageNumber.textContent = pageNum;
                                pageNumber.style.position = 'absolute';
                                pageNumber.style.bottom = '10px';
                                pageNumber.style.right = '10px';
                                pageNumber.style.fontSize = '12px';
                                pageNumber.style.color = '#333';
                                pageNumber.style.background = 'rgba(255,255,255,0.7)';
                                pageNumber.style.padding = '3px 8px';
                                pageNumber.style.borderRadius = '10px';
                                pageDiv.appendChild(pageNumber);
                                
                                // Render PDF page to canvas
                                const context = canvas.getContext('2d');
                                await page.render({
                                    canvasContext: context,
                                    viewport: scaledViewport
                                }).promise;
                                
                                console.log(`Rendered page ${pageNum} at scale ${scale.toFixed(2)}`);
            } catch (error) {
                                console.error(`Error rendering page ${pageNum}:`, error);
                                pageDiv.innerHTML = `<div style="padding: 20px; text-align: center;">
                                    Error loading page ${pageNum}<br>
                                    <small>${error.message}</small>
                                </div>`;
                            }
                        }
                        
                        // Load first few pages immediately
                        for (let i = 1; i <= Math.min(3, numPages); i++) {
                            loadPageContent(i);
                        }
                        
                        // Hide loading indicator
                        fileLoading.style.display = 'none';
                        flipbook.style.display = 'block';
                        
                        // Update button states
                        prevBtn.disabled = true; // Start at first page
                        nextBtn.disabled = numPages <= 1;
                        
                        // Add simple and direct click handlers for navigation
                        $(prevBtn).off('click').on('click', function() {
                            const currentPage = $(flipbook).turn('page');
                            console.log(`Previous clicked. Current page: ${currentPage}`);
                            
                            if (currentPage > 1) {
                                // Go to the exact previous page
                                const targetPage = currentPage - 1;
                                console.log(`Navigating to previous page: ${targetPage}`);
                                $(flipbook).turn('page', targetPage);
                            }
                            return false;
                        });
                        
                        $(nextBtn).off('click').on('click', function() {
                            const currentPage = $(flipbook).turn('page');
                            console.log(`Next clicked. Current page: ${currentPage}`);
                            
                            if (currentPage < numPages) {
                                // Go to the exact next page
                                const targetPage = currentPage + 1;
                                console.log(`Navigating to next page: ${targetPage}`);
                                $(flipbook).turn('page', targetPage);
                            }
                            return false;
                        });
                    }).catch(function(error) {
                        console.error('Error loading PDF:', error);
                        fallbackToPdfViewer(fileUrl);
                    });
                    } catch (e) {
                    console.error('General error in PDF processing:', e);
                    fallbackToPdfViewer(fileUrl);
                }
                
                // Fallback function for PDF viewing
                function fallbackToPdfViewer(pdfUrl) {
                    console.log('Using fallback PDF viewer');
                    fileLoading.style.display = 'none';
                    flipbookWrapper.style.display = 'none';
                    
                    // Try to display PDF in iframe
                iframe.onload = function() {
                    fileLoading.style.display = 'none';
                    iframe.style.display = 'block';
                };
                iframe.onerror = function() {
                    fileLoading.style.display = 'none';
                    unsupportedView.style.display = 'block';
                };
                    iframe.src = pdfUrl;
                }
            }
            else if (['doc', 'docx'].includes(fileExtension)) {
                // For Word documents, convert to PDF online and then use the PDF viewer
                // In a real implementation, you would use a service that converts DOCX to PDF or HTML
                // Here we use the Office Online Viewer as a simpler alternative
                iframe.onload = function() {
                    fileLoading.style.display = 'none';
                    iframe.style.display = 'block';
                };
                iframe.onerror = function() {
                    fileLoading.style.display = 'none';
                    unsupportedView.style.display = 'block';
                };
                const encodedUrl = encodeURIComponent(fileUrl);
                iframe.src = `https://view.officeapps.live.com/op/view.aspx?src=${encodedUrl}`;
            }
            else if (['txt', 'html', 'htm', 'css', 'js'].includes(fileExtension)) {
                // Text files in iframe 
                iframe.onload = function() {
                    fileLoading.style.display = 'none';
                    iframe.style.display = 'block';
                };
                iframe.onerror = function() {
                    fileLoading.style.display = 'none';
                    unsupportedView.style.display = 'block';
                };
                iframe.src = fileUrl;
            }
            else {
                // Unsupported file type - show download option
                fileLoading.style.display = 'none';
                unsupportedView.style.display = 'block';
            }
            
            // Show the modal
            modal.style.display = 'block';
        }
        
        // Helper function to format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
        
        // Helper function to format date
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            var burger = document.getElementById('admin-hamburger');
            var menu = document.getElementById('admin-mobile-menu');
            var overlay = document.getElementById('admin-mobile-overlay');
            var logout = document.getElementById('admin-mobile-logout');
            if (burger && menu && overlay) {
                burger.addEventListener('click', function() {
                    menu.classList.add('open');
                    overlay.classList.add('open');
                });
                overlay.addEventListener('click', function() {
                    menu.classList.remove('open');
                    overlay.classList.remove('open');
                });
                if (logout) {
                    logout.addEventListener('click', function(e) {
                        e.preventDefault();
                        // Chame sua função de logout aqui:
                        if (typeof logout === 'function') logout();
                        else window.location.href = 'login.html';
                    });
                }
            }
        });
    </script>
</body>
</html> 